---
title: "Project A1 : Fungal invasion of the Apple fruit"
author: "Auriane Cozic, Thibault de La Taille, Eloi Littner, Audrey Menaesse"
date: "March 20, 2020"
output: 
  pdf_document:
    df_print: paged
geometry: margin=2.5cm
fontsize: 12pt
df_print: paged
---




#### Internal questions 
 
- Is radius the radius of the apple ? If yes, how do you interpret the fact that the Fungal Radial Advance is bigger than the size of the apple ?
-> (Auriane) Yes I think it is the radius of the apple. It is usually not bigger than the radial fungal advance if you look line by line, except for line 18 and 21. And I am not sure how to explain it either... Je propose de juste les enlever

```{r}
data[,5]>data[,6]
```


#Import and loading data

```{r, echo=FALSE}
#Load libraries and packages
```


```{r}
data <-read.table("http://users.stat.ufl.edu/~winner/data/apple1.dat")
colnames(data) <- c("variety", "strain", "days", "weight", "radius", "fungal radial advance", "rate of advance")
data
```

#### Data description


Description : This data set is used to describe the fungal invasion of 5 varieties of apple by 7 different fusarium strains.  

Variables/names :


Questions : We are interested in comparing
  - the infecting power depending on the conditions of infection (strain of fungi, day of infection, temperature)
  - the resistance to invasion of different varieties of apples, and their characteristics (weight, radius)
  
#### Exploratory data analysis 
```{r}
data$variety <- as.factor(data$variety)
data$strain <- as.factor(data$strain)
str(data)
```

```{r}
summary(data)
```


Different plots to illustrate the data, dependencies on factors: (à enlever je pense, meilleurs graphs dessous)
```{r}
plot(data$strain,data$`rate of advance`)
#outliers lines : 18, 19, 21 + 25, 3
plot(data$variety,data$`rate of advance`)  
plot(data$days,data$`rate of advance`)
plot(data$strain, data$`fungal radial advance`)
#outliers lines : 3, 19, 21, 28, 34
plot(data$variety, data$`fungal radial advance`)
plot(data$days, data$`fungal radial advance`)
```

We can see that the variance of rate of advance is very dependent on the experiment (on the variety and strain especially).
We can see about the mean of rate of advance and of fungal radius :
 - strain 3, and also 2 and 1 lower
 - variety 3 higher
 (see more below)
 
Ouliers detected : see code comments
 


## Fungal radial advance dependencies

Here, we want to observe the rate of advance of the fungal invasion depending on the fusarium strain and the variety of apple. 

```{r}
plot.design(x=data$`fungal radial advance`~.,data=data[,c(1,2,6)], ylab= 'Fungal radial advance')
plot.design(x=data$`fungal radial advance`~.,data=data[,c(1,2,6)], ylab= 'Fungal radial advance', fun=sd)

```

2 strains seem very less virulent (2 & 3 corresponding to strains B).
Variance is very dependent on the variety : variety 3 has especially high sd


```{r}
boxplot(data$`fungal radial advance`~data$days, ylab='Fungal radial advance')
```

Doesn't seem very significant exept high variance for day 54 . 

```{r}
plot(data$weight, data$`fungal radial advance`)
plot(data$radius, data$`fungal radial advance`)
```

No pattern. higher variance at low values.

## Rate of advance
```{r}
tapply(data$`rate of advance`, list(data$strain, data$variety), mean)
```


```{r}
plot.design(x=data$`rate of advance`~.,data=data[,c(1,2,7)], ylab= 'Rate of fungal advance')
plot.design(x=data$`rate of advance`~.,data=data[,c(1,2,7)], ylab= 'Rate of fungal advance', fun =sd)

```

The strain part is similar to fungal radius.
Same tendencies also for variety, however, more marked here.

Variety 3 has still a very higher sd
Otherwise, less variance differences


```{r}
tapply(data$`rate of advance`, list(data$strain, data$days), mean)
```

```{r}
boxplot(data$`rate of advance`~data$days, ylab='Fungal rate of advance')
```

The rate of advance seem inversly correlated to the day of infection !

Also we can see one oulier :

```{r}
data[17,]
```
It is this one which create high variance for day54 and variety 3.


```{r}
plot(data$weight, data$`rate of advance`)
plot(data$radius, data$`rate of advance`)
```

No pattern. higher variance at low values.

##Remove outliers

I propose to remove 3 outliers :
 - 18 et 21 : fungi radius > apple radius
 - 17 : add lots of variance
 
```{r}
data.rm<- data[-c(17,18,21),]
```



####Model selection

Definition of the different linear models

```{r}
fit.s = lm(`rate of advance` ~ strain, data=data)
fit.v=lm(`rate of advance`~variety, data = data)
fit.sv = lm(`rate of advance` ~ strain+variety, data=data)
fit.svd = lm (`rate of advance` ~ strain+variety+days, data=data)
fit.svdw = lm (`rate of advance` ~ strain+variety+days+weight, data=data)
fit.svdwr = lm (`rate of advance` ~ strain+variety+days+weight+radius, data=data)

```


Comparing the different models with anova method :
```{r}
anova(fit.s, fit.sv)
anova(fit.v, fit.sv)
```
```{r}
summary(fit.svdwr)
anova(fit.svdwr)
```

Only strains and variety seem significative. 
(Where TF is days ???) -> le convertir de int a num et relancer !!!

##Stepwise selection of variables
```{r}
fit.step <- step(lm(`rate of advance` ~ strain+variety, data=data))

fit.all.step <- step(lm(`rate of advance` ~ strain+variety+days+weight+radius, data=data))
```

Stepwise procedure arrive au meme resultat : only strains and variety.

```{r}
summary(fit.all.step)
```



#Autre méthode (meme resultat)

test stepwise exploration in AIC parameter, w/o fungal radial advance (too correlated)
```{r}
require(MASS)
fit.fullAIC <- stepAIC(lm(`rate of advance`~variety+strain+days+radius+weight, data = data), data=data)
summary(fit.fullAIC)
for (k in 1:6) {
  plot(fit.fullAIC, which=k)
}
#clearly 16 and 17 are aberrant, but why? 
#Auriane : 17 c'est juste une exp qui a pas pris je pense (pomme pas infectée) -> perso je propose de l'enlever avant toutes les analyses
```


Stepwise : refaire avec un scope, pas juste degressif 


##Correlations 

Explore correlations and colinearity: 
```{r}
pairs(data)
cov(data[c("days", "weight", "radius", "fungal radial advance", "rate of advance")])
cor(data[c("days", "weight", "radius", "fungal radial advance", "rate of advance")])

p.cor<-function(x){
  inv<-solve(var(x))
  sdi<-diag(1/sqrt(diag(inv)))
  p.cor.mat<--(sdi%*%inv%*%sdi)
  diag(p.cor.mat)<-1
  rownames(p.cor.mat)<-colnames(p.cor.mat)<-colnames(x)
  return(p.cor.mat)}
p.cor(data[c("days", "weight", "radius", "fungal radial advance", "rate of advance")])
```
Correlations : attendues
 - weight et radius
 - fungal radius et rate of advance

On peut se contenter de regarder fungal radius ou rate of advance a priori.


####Interactions 
```{r}
interaction.plot(data$strain, data$variety, data$'rate of advance' )
interaction.plot(data$variety, data$strain, data$'rate of advance' )

interaction.plot(data$days, data$strain, data$'rate of advance' )


```

Interaction variety 3 * strain 3  et variety 2 * strain 3 possible.


```{r}
fit.inter1 <- aov(`rate of advance` ~ strain*variety, data=data)
summary(fit.inter1)
```
```{r}
fit.inter2 <- aov(`rate of advance` ~ variety*strain, data=data)
summary(fit.inter2)
```

Interprétation ???


#Foster differences

```{r}
foster.hsd <- TukeyHSD(fit.inter1, "strain")
plot(foster.hsd)
```


####T

Verify time dependence
```{r}
par(mfrow = c(1,3), adj = 0.5)
plot(data$days, residuals(fit.s))
title(('residuals of fit.s versus days'))
plot(data$days, residuals(fit.v))
title(('residuals of fit.v versus days'))
plot(data$days, residuals(fit.sv))
title(('residuals of fit.sv versus days'))

par(mfrow = c(1,3), adj = 0.5)
plot(data$weight, residuals(fit.s))
title(('residuals of fit.s versus weight'))
plot(data$weight, residuals(fit.v))
title(('residuals of fit.v versus weight'))
plot(data$weight, residuals(fit.sv))
title(('residuals of fit.sv versus weight'))
```
test time dependence of rate of advance 
```{r}
par(pty="m")
layout(matrix(1:4, nrow = 2))
data.s1 <-subset(data, strain ==1)
data.s2 <-subset(data, strain ==2)
data.s3 <-subset(data, strain ==3)
data.s4 <-subset(data, strain ==4)
data.s5 <-subset(data, strain ==5)
data.s6 <-subset(data, strain ==6)
data.s7 <-subset(data, strain ==7)
plot(x = data.s1$days, data.s1$`rate of advance`)
title("strain 1 = f(t)")
plot(x = data.s2$days, data.s2$`rate of advance`)
title("strain 2 = f(t)")
plot(x = data.s3$days, data.s3$`rate of advance`)
title("strain 3 = f(t)")
plot(x = data.s4$days, data.s4$`rate of advance`)
title("strain 4 = f(t)")
plot(x = data.s5$days, data.s5$`rate of advance`)
title("strain 5 = f(t)")
plot(x = data.s6$days, data.s6$`rate of advance`)
title("strain 6 = f(t)")
plot(x = data.s7$days, data.s7$`rate of advance`)
title("strain 7 = f(t)")
```
idem for radial advance
```{r}
par(pty="m")
layout(matrix(1:4, nrow = 2))
data.s1 <-subset(data, strain ==1)
data.s2 <-subset(data, strain ==2)
data.s3 <-subset(data, strain ==3)
data.s4 <-subset(data, strain ==4)
data.s5 <-subset(data, strain ==5)
data.s6 <-subset(data, strain ==6)
data.s7 <-subset(data, strain ==7)
plot(x = data.s1$days, data.s1$`fungal radial advance`)
title("strain 1 = f(t)")
plot(x = data.s2$days, data.s2$`fungal radial advance`)
title("strain 2 = f(t)")
plot(x = data.s3$days, data.s3$`fungal radial advance`)
title("strain 3 = f(t)")
plot(x = data.s4$days, data.s4$`fungal radial advance`)
title("strain 4 = f(t)")
plot(x = data.s5$days, data.s5$`fungal radial advance`)
title("strain 5 = f(t)")
plot(x = data.s6$days, data.s6$`fungal radial advance`)
title("strain 6 = f(t)")
plot(x = data.s7$days, data.s7$`fungal radial advance`)
title("strain 7 = f(t)")
```





