---
title: "Project A1 : Fungal invasion of the Apple fruit"
author: "Auriane Cozic, Thibault de La Taille, Eloi Littner, Audrey Menaesse"
date: "May 1st, 2020"
output: 
  pdf_document:
    df_print: paged
geometry: margin=2.5cm
fontsize: 12pt
df_print: paged
---



#Introduction ()



#Import and loading data


```{r, echo=FALSE}
#Load libraries and packages
require(MASS)
```

```{r}
data <-read.table("http://users.stat.ufl.edu/~winner/data/apple1.dat")
colnames(data) <- c("variety", "strain", "days", "weight", "radius", "fungal radial advance", "rate of advance")
```

We add some meta data, that are under the general "strain" variable
```{r}
data$variety[data$variety <= 2]<-"Bramley"
data$variety[data$variety <= 5]<-"Cox"

data$year = 1924
data$year[data$days == 70] <- 1925
data$year[data$days == 86] <- 1925

data$temperature<-12
data$temperature[data$days == 138]<-3

data$variety <- as.factor(data$variety)
data$strain <- as.factor(data$strain)
data$year <- as.factor(data$year) 
data$temperature<- as.factor(data$temperature)#TODO : I'm not sure about the fact that year should be a factor and temperature not
str(data) 

```

#### Data description
#TODO : detail this description. Say why we remove days from our explainatory, and why rate of advance is our final choice for main variable + why we remove outliers

Description : This data set is used to describe the fungal invasion of 5 varieties of apple by 7 different fusarium strains.  

Variables/names :


Questions : We are interested in comparing
  - the infecting power depending on the conditions of infection (strain of fungi, day of infection, temperature)
  - the resistance to invasion of different varieties of apples, and their characteristics (weight, radius)
  
#### Exploratory data analysis 


We can see that the variance of rate of advance is very dependent on the experiment (on the variety and strain especially).
We can see about the mean of rate of advance and of fungal radius :
 - strain 3, and also 2 and 1 lower
 - variety 3 higher
 (see more below)
 
Ouliers detected : see code comments
#TODO : move this comment to the appropriate location


## Rate of advance
#TODO : replace data by data.rm and rerun 

 
```{r}
data.rm<- data[-c(17,18,21),]
```

```{r}
plot.design(x=data$`rate of advance`~.,data=data[,c(1,2,7,8,9)], ylab= 'Rate of fungal advance')

```
#TODO : make the graph more pretty 
```{r}
boxplot(data$`rate of advance`~data$variety, ylab='Fungal rate of advance')
boxplot(data$`rate of advance`~data$strain, ylab='Fungal rate of advance')
boxplot(data$`rate of advance`~data$temperature, ylab='Fungal rate of advance')
boxplot(data$`rate of advance`~data$year, ylab='Fungal rate of advance')
```

#TODO : comment more on these graphs. Say that we show them because seems to be a difference in the last plot. Check if enough space for both graphs ore only first or second ?


```{r}
plot(data$weight, data$`rate of advance`)
```
#TODO : interpret this graph. Remove the graph end say just a sentence about it. 


##Correlations 

Explore correlations and colinearity: 
```{r}
pairs(data[c("days", "weight", "radius", "fungal radial advance", "rate of advance")])
#cov(data[c("days", "weight", "radius", "fungal radial advance", "rate of advance")])
cor(data[c("weight", "radius", "fungal radial advance", "rate of advance")])


#plot(x = data$days, y=data$year)
require('ggplot2')
layout(matrix(1:3, ncol=3))
qplot(data$days,data$year)
qplot(data$days,data$temperature)
qplot(data$days,data$variety)

# ""
# "corrected correlations"
# ""
# 
# p.cor<-function(x){
#   inv<-solve(var(x))
#   sdi<-diag(1/sqrt(diag(inv)))
#   p.cor.mat<--(sdi%*%inv%*%sdi)
#   diag(p.cor.mat)<-1
#   rownames(p.cor.mat)<-colnames(p.cor.mat)<-colnames(x)
#   return(p.cor.mat)}
# #p.cor(data[c("strain","days", "weight", "radius","temperature", "fungal radial advance", "rate of advance", "year")])
```
#TODO : virer le matrix plot, et voir si on a la place de mettre les trois graphs de la fin, sinon les téj et mettre une phrase. Move to supplementary 
On voit bien une forte corrÃ©lation entre "weight" et "radius" sur le 1er graphe, ce qui est confirmÃ© par les coefficients de corrÃ©lation; de mÃªme entre "rate of advance" et "fungal radial advance". 
Cela est bien cohÃ©rent en fonction des mÃ©thodes de calcul liant les 2 respectivement (avec approximation pour weight). 

De plus, en observant les relations entre "days" et les autres facteurs ("year", "temperature" et "variety", d'oÃ¹ sont extraites ces informations), il apparaÃ®t que "days" contient toutes ces facteurs, mais de maniÃ¨re non linÃ©aire; et est donc Ã  exclure car risquant de fausser l'analyse sans gain d'information.


#TODO : check homscedasticity ? (if enough space)





####Model selection

Definition of the different linear models




##Stepwise selection of variables
```{r}
fit.stepAIC <- stepAIC(lm(`rate of advance` ~ variety+strain+weight+temperature+year, data=data))
```


#TODO : not show above, only that year was removed (and show further that coeffs are roughly the same)


```{r}
fit.stepAIC
```


#Interpretation

```{r}
for (k in c(4)) {
  plot(fit.stepAIC, which=k)
}
```


#If enough space, add some elements to compare the models
```{r}
fit.rm.stepAIC <- stepAIC(lm(`rate of advance` ~ variety+strain+weight+temperature, data=data.rm))
fit.rm.stepAICfull <- stepAIC(lm(`rate of advance` ~ variety+strain+weight+temperature+year, data=data.rm))
summary(fit.rm.stepAIC)

```
```{r}

for (k in c(1,2)) {
  plot(fit.rm.stepAIC, which=k)
}
```

#TODO : interpret the model, explain the outliers 
#TODO : explain here why we don't fit the full model (remove year) : coherent with full data (with outliers)

```{r}
anova(fit.rm.stepAIC,fit.rm.stepAICfull)
```




### Verify model fit : residuals







##Check for time dependencies (Thibault)

test time dependence of rate of advance 
```{r}

plot(x=data.rm$days, y= residuals(fit.rm.stepAIC))
title("residuals= f(days)")
```

Homoscedasticity among all groups


#Discussion / Results (short)


###Conclusion
#TODO : finish it
The most impactant variable is the day of the infection : the infection is strongest (progresses more rapidly) when the apple is infected early.
(Pas tres sure de comment interpreter Ã§a ?)

The strains B (strains 2 and 3) are very less virulent.

Finally, low temperature leads to more resistance of the apple.

#Question to the teacher
Is our method ok or only ANOVA ?
Do you validate the part when we remove year ? 


#Répartition

Corrélations + Conclusion : Thibault 
EDA sauf corrélations : Audrey 
Fit du model : Eloi
Residuals + discussion : Auriane


